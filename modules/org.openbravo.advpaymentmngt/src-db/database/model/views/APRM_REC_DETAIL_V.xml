<?xml version="1.0"?>
  <database name="VIEW APRM_REC_DETAIL_V">
    <view name="APRM_REC_DETAIL_V"><![CDATA[((SELECT get_uuid() AS aprm_rec_detail_v_id, to_char('APRM_Reconciled') AS type, fin_finacc_transaction.fin_reconciliation_id, COALESCE(count(*), 0) AS item_no, COALESCE(sum(fin_finacc_transaction.depositamt - fin_finacc_transaction.paymentamt), 0) AS item_amt, fin_reconciliation.ad_client_id, fin_reconciliation.ad_org_id, fin_reconciliation.created, fin_reconciliation.createdby, fin_reconciliation.updated, fin_reconciliation.updatedby, fin_reconciliation.isactive
FROM fin_finacc_transaction, fin_reconciliation
WHERE fin_finacc_transaction.fin_reconciliation_id = fin_reconciliation.fin_reconciliation_id
GROUP BY fin_finacc_transaction.fin_reconciliation_id, fin_reconciliation.ad_client_id, fin_reconciliation.ad_org_id, fin_reconciliation.created, fin_reconciliation.createdby, fin_reconciliation.updated, fin_reconciliation.updatedby, fin_reconciliation.isactive
UNION ALL 
SELECT get_uuid() AS aprm_rec_detail_v_id, to_char('APRM_UnReconciled') AS type, fin_reconciliation.fin_reconciliation_id, COALESCE(count(*), 0) AS item_no, COALESCE(sum(fin_bankstatementline.cramount - fin_bankstatementline.dramount), 0) AS item_amt, fin_reconciliation.ad_client_id, fin_reconciliation.ad_org_id, fin_reconciliation.created, fin_reconciliation.createdby, fin_reconciliation.updated, fin_reconciliation.updatedby, fin_reconciliation.isactive
FROM fin_bankstatementline, fin_bankstatement, fin_reconciliation
WHERE (fin_bankstatementline.fin_finacc_transaction_id IS NULL OR (EXISTS (SELECT 1
FROM fin_finacc_transaction, fin_reconciliation rec
WHERE fin_finacc_transaction.fin_reconciliation_id = rec.fin_reconciliation_id AND fin_bankstatementline.fin_finacc_transaction_id = fin_finacc_transaction.fin_finacc_transaction_id AND fin_finacc_transaction.fin_financial_account_id = fin_bankstatement.fin_financial_account_id AND rec.created > fin_reconciliation.created))) AND fin_bankstatementline.datetrx <= fin_reconciliation.dateto AND fin_bankstatement.fin_bankstatement_id = fin_bankstatementline.fin_bankstatement_id AND fin_bankstatement.fin_financial_account_id = fin_reconciliation.fin_financial_account_id
GROUP BY fin_reconciliation.fin_reconciliation_id, fin_reconciliation.ad_client_id, fin_reconciliation.ad_org_id, fin_reconciliation.created, fin_reconciliation.createdby, fin_reconciliation.updated, fin_reconciliation.updatedby, fin_reconciliation.isactive)
UNION ALL 
SELECT get_uuid() AS aprm_rec_detail_v_id, to_char('APRM_OutstandingPayments') AS type, fin_reconciliation.fin_reconciliation_id, COALESCE(sum(
CASE COALESCE(fin_finacc_transaction.paymentamt, 0)
WHEN 0 THEN 0
ELSE 1
END), 0) AS item_no, COALESCE(sum(fin_finacc_transaction.paymentamt), 0) AS item_amt, fin_reconciliation.ad_client_id, fin_reconciliation.ad_org_id, fin_reconciliation.created, fin_reconciliation.createdby, fin_reconciliation.updated, fin_reconciliation.updatedby, fin_reconciliation.isactive
FROM fin_finacc_transaction, fin_reconciliation
WHERE (fin_finacc_transaction.fin_reconciliation_id IS NULL OR (EXISTS (SELECT 1
FROM fin_reconciliation r
WHERE r.dateto > fin_reconciliation.dateto AND fin_finacc_transaction.fin_reconciliation_id = r.fin_reconciliation_id))) AND fin_finacc_transaction.statementdate <= fin_reconciliation.dateto AND fin_finacc_transaction.fin_financial_account_id = fin_reconciliation.fin_financial_account_id
GROUP BY fin_reconciliation.fin_reconciliation_id, fin_reconciliation.ad_client_id, fin_reconciliation.ad_org_id, fin_reconciliation.created, fin_reconciliation.createdby, fin_reconciliation.updated, fin_reconciliation.updatedby, fin_reconciliation.isactive)
UNION ALL 
SELECT get_uuid() AS aprm_rec_detail_v_id, to_char('APRM_OutstandingDeposits') AS type, fin_reconciliation.fin_reconciliation_id, COALESCE(sum(
CASE COALESCE(fin_finacc_transaction.depositamt, 0)
WHEN 0 THEN 0
ELSE 1
END), 0) AS item_no, COALESCE(sum(fin_finacc_transaction.depositamt), 0) AS item_amt, fin_reconciliation.ad_client_id, fin_reconciliation.ad_org_id, fin_reconciliation.created, fin_reconciliation.createdby, fin_reconciliation.updated, fin_reconciliation.updatedby, fin_reconciliation.isactive
FROM fin_finacc_transaction, fin_reconciliation
WHERE (fin_finacc_transaction.fin_reconciliation_id IS NULL OR (EXISTS (SELECT 1
FROM fin_reconciliation r
WHERE r.dateto > fin_reconciliation.dateto AND fin_finacc_transaction.fin_reconciliation_id = r.fin_reconciliation_id))) AND fin_finacc_transaction.statementdate <= fin_reconciliation.dateto AND fin_finacc_transaction.fin_financial_account_id = fin_reconciliation.fin_financial_account_id
GROUP BY fin_reconciliation.fin_reconciliation_id, fin_reconciliation.ad_client_id, fin_reconciliation.ad_org_id, fin_reconciliation.created, fin_reconciliation.createdby, fin_reconciliation.updated, fin_reconciliation.updatedby, fin_reconciliation.isactive]]></view>
  </database>
